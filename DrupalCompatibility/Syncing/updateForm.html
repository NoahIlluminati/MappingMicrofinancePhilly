<style>

  form {
    font-family: Lato, Verdana, Helvetica;
  }

  label {
    display: block;
    margin: 10 0;
    width: 600px;
    border-top: 1px solid #FFF;
    border-bottom: 1px solid #FFF;
    padding: 5px;
  }

  label:hover {
    background: rgba(120,220,80,.4);
    border-top: 1px solid #888;
    border-bottom: 1px solid #888;
  }

  input {
    width: 150px;
    margin: 0;
    float: right;
  }

  h3 {
    border-top: 1px solid #999;
    border-bottom: 1px solid #999;
    width: 40%;
    padding: 8px 0;
  }

  ul {
    list-style-type: none;
  }

  input[type='submit'] {
    float: none;
    margin: 0 auto;
  }

</style>

<!--jQuery-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<form>
  <label>Location Name:<input id="loc_name" type="text"></label>
  <label>Link to Website:<input id="link" type="text"></label>
  <label>Email:<input id="email" type="text"></label>
  <label>Phone Number:<input id="phone_number" type="text"></label>
  <label>Address:<input id="address" type="text"></label>
  <label>City:<input id="city" type="text"></label>
  <label>State:<input id="state" type="text"></label>
  <label>Zip Code:<input id="zipcode" type="text"></label>
  <label>Mission Statement:<input id="mission" type="text"></label>
  <label>Longitude:<input id="longitude" type="number" value="0"></label>
  <label>Lattitude:<input id="lattitude" type="number" value="0"></label>
  <div id="toggle-panels">
  <h3>Types</h3>
  <div id="types">
    <ul>
      <li><label>1-on-1 Consulting<input type="checkbox" data="1-on-1 Consulting"></label></li>
      <li><label>Classes<input type="checkbox" data="Classes"></label></li>
      <li><label>Directory<input type="checkbox" data="Directory"></label></li>
      <li><label>Financial Literacy<input type="checkbox" data="Financial Literacy"></label></li>
      <li><label>Grants<input type="checkbox" data="Grants"></label></li>
      <li><label>Group Consulting<input type="checkbox" data="Group Consulting"></label></li>
      <li><label>Group Network<input type="checkbox" data="Group Network"></label></li>
      <li><label>Incubator<input type="checkbox" data="Incubator"></label></li>
      <li><label>Kiva Zip Trustee<input type="checkbox" data="Kiva Zip Trustee"></label></li>
      <li><label>Loan Intermediary<input type="checkbox" data="Loan Intermediary"></label></li>
      <li><label>Microloans<input type="checkbox" data="Microloans"></label></li>
      <li><label>Midsize Loans<input type="checkbox" data="Midsize Loans"></label></li>
      <li><label>Networking Events<input type="checkbox" data="Networking Events"></label></li>
      <li><label>Regulatory Help<input type="checkbox" data="Regulatory Help"></label></li>
      <li><label>Relocation<input type="checkbox" data="Relocation"></label></li>
      <li><label>Savings Program<input type="checkbox" data="Savings Program"></label></li>
      <li><label>Seed Capital<input type="checkbox" data="Seed Capital"></label></li>
      <li><label>Workshops<input type="checkbox" data="Workshops"></label></li>
      <li><label>Work Space<input type="checkbox" data="Work Space"></label></li>
    </ul>
  </div>
  <h3>Areas Served</h3>
  <div id="areas">
    <ul>
      <li><label>Atlantic County<input type="checkbox" data="Atlantic County"></label></li>
      <li><label>Berks County<input type="checkbox" data="Berks County"></label></li>
      <li><label>Brewerytown, Philadelphia<input type="checkbox" data="Brewerytown, Philadelphia"></label></li>
      <li><label>Bucks County<input type="checkbox" data="Bucks County"></label></li>
      <li><label>Burlington County<input type="checkbox" data="Burlington County"></label></li>
      <li><label>Camden County<input type="checkbox" data="Camden County"></label></li>
      <li><label>Carbon County<input type="checkbox" data="Carbon County"></label></li>
      <li><label>Center City District<input type="checkbox" data="Center City District"></label></li>
      <li><label>Chester County<input type="checkbox" data="Chester County"></label></li>
      <li><label>Chinatown, Philadelphia<input type="checkbox" data="Chinatown, Philadelphia"></label></li>
      <li><label>Cumberland County<input type="checkbox" data="Cumberland County"></label></li>
      <li><label>Delaware County<input type="checkbox" data="Delaware County"></label></li>
      <li><label>Delaware State<input type="checkbox" data="Delaware State"></label></li>
      <li><label>East Kensington, Philadelphia<input type="checkbox" data="East Kensington, Philadelphia"></label></li>
      <li><label>Fairmount, Philadelphia<input type="checkbox" data="Fairmount, Philadelphia"></label></li>
      <li><label>Fishtown, Philadelphia<input type="checkbox" data="Fishtown Philadelphia"></label></li>
      <li><label>Francisville, Philadelphia<input type="checkbox" data="Francisville, Philadelphia"></label></li>
      <li><label>Gloucester County<input type="checkbox" data="Gloucester County"></label></li>
      <li><label>Greater Philadelphia Area<input type="checkbox" data="Greater Philadelphia Area"></label></li>
      <li><label>Harrowgate, Philadelphia<input type="checkbox" data="Harrowgate, Philadelphia"></label></li>
      <li><label>Kent County<input type="checkbox" data="Kent County"></label></li>
      <li><label>Lehigh County<input type="checkbox" data="Lehigh County"></label></li>
      <li><label>Main Line Region<input type="checkbox" data="Main Line Region"></label></li>
      <li><label>Mercer County<input type="checkbox" data="Mercer County"></label></li>
      <li><label>Montgomery County<input type="checkbox" data="Montgomery County"></label></li>
      <li><label>New Castle County<input type="checkbox" data="New Castle County"></label></li>
      <li><label>New Jersey<input type="checkbox" data="New Jersey"></label></li>
      <li><label>New York<input type="checkbox" data="New York"></label></li>
      <li><label>Northampton County<input type="checkbox" data="Northampton County"></label></li>
      <li><label>North Central Philadelphia Empowerment Zone<input type="checkbox" data="North Central Philadelphia Empowerment Zone"></label></li>
      <li><label>Olde Richmond, Philadelphia<input type="checkbox" data="Olde Richmond, Philadelphia"></label></li>
      <li><label>Open<input type="checkbox" data="Open"></label></li>
      <li><label>Pennsylvania<input type="checkbox" data="Pennsylvania"></label></li>
      <li><label>Philadelphia County<input type="checkbox" data="Philadelphia County"></label></li>
      <li><label>Port Richmond, Philadelphia<input type="checkbox" data="Port Richmond, Philadelphia"></label></li>
      <li><label>Salem County<input type="checkbox" data="Salem County"></label></li>
      <li><label>Schuylkill County<input type="checkbox" data="Schuylkill County"></label></li>
      <li><label>Southeastern Pennsylvania<input type="checkbox" data="Southeastern Pennsylvania"></label></li>
      <li><label>South Street Head House District<input type="checkbox" data="South Street Head House District"></label></li>
      <li><label>Spring Garden, Philadelphia<input type="checkbox" data="Spring Garden, Philadelphia"></label></li>
      <li><label>Sussex County<input type="checkbox" data="Sussex County"></label></li>
      <li><label>United States<input type="checkbox" data="United States"></label></li>
      <li><label>West Philadelphia<input type="checkbox" data="West Philadelphia"></label></li>
    </ul>
  </div>
</div>
<input type="submit" value="Submit">
</form>

<script type="text/javascript">
//Function to create a menu. Taken from http://jsfiddle.net/DkHyd/ I AM NOT SURE WHO WROTE THIS CODE
(function() {
$.fn.togglepanels = function(){
  return this.each(function(){
    $(this).find("h3")
    .click(function() {
      $(this)
        .find("> .ui-icon").toggleClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").end()
        .next().slideToggle();
      return false;
    })
    .next()
      .hide();
  });
};
$(document).ready(function() {
  $('#toggle-panels').togglepanels();

  $('form').submit(function(event) {
    event.preventDefault();
    //regex taken from http://code.tutsplus.com/tutorials/8-regular-expressions-you-should-know--net-6149 and slightly altered
    var linkRegex = /^https?:\/\/([\da-z\.-]+)\.([a-z\.]{2,})([\/\w \.-]*)*\/?$/;
    var notNums = /[^\d]/g;
    var phoneNumber = $('#phone_number').val().replace(notNums, '');
    var successCheck = 0;  //used to check if the other asynchronous callback set has finished
    if (phoneNumber === '') {phoneNumber = 0;}
    //Regexes should be used to check values before this
    var locSQL = 'INSERT INTO location (loc_name, link, email, phone_number, address, city, state, zipcode, mission, the_geom) ' +
                  'VALUES (\'' + $('#loc_name').val() + '\',\'' + $('#link').val() + '\',\'' + $('#email').val() + '\',\'' +
                  phoneNumber + '\'::bigint,\'' + $('#address').val() + '\',\'' + $('#city').val() + '\',\'' +
                  $('#state').val() + '\',\'' + $('#zipcode').val() + '\',\'' + $('#mission').val() + '\',ST_SetSRID(ST_Point(\'' +
                  $('#longitude').val() + '\'::float,\'' + $('#lattitude').val() + '\'::float), 4326))';
    console.log(locSQL);
    var apikey = 'place holder';
    //Enter callback hell
    $.ajax({url: 'https://haverfordds.cartodb.com/api/v2/sql?q=' + locSQL + '&api_key=' + apikey, type: 'post',
      success: function() {
        $.getJSON('https://haverfordds.cartodb.com/api/v2/sql?format=JSON&q=SELECT cartodb_id FROM location WHERE loc_name=\'' + $('#loc_name').val() + '\'', function addLookupEntries(data) {
          var locid=data.rows[0].cartodb_id;
          $('#types input:checked').each(function addTypeEntry() {
            var typename = $(this).attr('data');
            $.getJSON('https://haverfordds.cartodb.com/api/v2/sql?format=JSON&q=SELECT cartodb_id FROM type WHERE type=\'' + typename + '\'', function(dats) {
              var typeid = dats.rows[0].cartodb_id;
              $.ajax({url: 'https://haverfordds.cartodb.com/api/v2/sql?q=INSERT INTO lookup_loc_test (loc_id, type_id) VALUES (' + locid + ',' +  typeid + ')&api_key=' + apikey,
                type: 'post',
                success: function () {
                  if (successCheck >= ($('#areas input:checked').length + $('#types input:checked').length)) {
                    console.log("Both types and areas added succesfully!")
                  } else {
                    successCheck++;
                  }
                }});
            });
          });
          $('#areas input:checked').each(function addAreaEntry() {
            var areaname = $(this).attr('data');
            $.getJSON('https://haverfordds.cartodb.com/api/v2/sql?format=JSON&q=SELECT cartodb_id FROM area_served WHERE area_name=\'' + areaname + '\'', function(dats) {
              var areaid = dats.rows[0].cartodb_id;
              $.ajax({url: 'https://haverfordds.cartodb.com/api/v2/sql?q=INSERT INTO lookup_loc_area_test (loc_id, area_id) VALUES (' + locid + ',' +  areaid + ')&api_key=' + apikey,
                type: 'post',
                success: function () {
                  if (successCheck >= ($('#areas input:checked').length + $('#types input:checked').length - 1)) {
                    console.log("Both types and areas added succesfully!")
                  } else {
                    successCheck++;
                  }
                }});
            });
          });
        });
      }});
  });
});
})(jQuery);
</script>
