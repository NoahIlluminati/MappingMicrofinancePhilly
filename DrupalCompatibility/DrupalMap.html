
      <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />

      <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.14/themes/css/cartodb.css" type="text/css" />
      <link rel="stylesheet" href="http://academy.cartodb.com/css/cdbui.css" type="text/css" />
      <!--Jquery-->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      <!--<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" />-->
      <!--May not need the actual library for jqueryui-->

      <style type="cartocss/html" id="simple">
        #location {
          marker-fill-opacity: 0.9;
          marker-line-color: #FFF;
          marker-line-width: 1.5;
          marker-line-opacity: 1;
          marker-placement: point;
          marker-type: ellipse;
          marker-width: 14;
          marker-fill: #A62011;
          marker-allow-overlap: true;
        }
      </style>
      <style type="cartocss/html" id="county">
        #pa_counties_clip, #tl_2010_34_county10, #tl_2010_10_county10 {
          polygon-fill: #FFFFFF;
          polygon-opacity: 0;
          line-color: #1197A6;
          line-width: 2;
          line-opacity: .3;
        }
      </style>
      <style>
      html, body, #map{
          height: 100%;
          padding: 0;
          margin: 0;
      }

      #map {
        height: 600px; height: 100vh;
      }

      body, #deselect {
        font-family: Lato, Helvetica;
        font-size: .9em; font-size: 18px;
        color:#444;
      }

      #sql, #area_served-form, #infowindow {
        z-index: 1;
      }

      #area_served-form {
        padding: 7px 15px;
      }

      .layer_selector {
        text-align: center;
      }

      #infowindow {
        position: absolute;
        top: 0px;
        right: 0px;
        width: 457px;
        display: none;
        background: rgba(255,255,255,0.9);
        border: 1px solid #999;
        border-radius:  4px;
        padding: 2px;
        font-size: 1em;
      }

      #infowindow > p {
        display: inline;
      }

      /* tab styling from https://css-tricks.com/better-tabs-with-round-out-borders/ */
      .info-tab {
        background: #EEE;
        border: 1px solid #999;
        margin: 0px 0px;
        padding: 2px 10px;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
      }
      .info-tab:hover {
        cursor: pointer;
      }
      .info-selected {
        background: #FFF;
        color: #000;
        border-bottom: 1px solid #FFF;
        z-index: 2;
      }
      #tabrow {
        margin: 0;
        margin-top: 4px;
        padding: 0;
        border-bottom: 1px solid #999;
        z-index: 1;
      }

      #infowindow > span {
        width: 18px;
        height: 18px;
        border-radius: 9px;
        float: right;
        position: absolute;
        top: 8px;
        right: 5px;
      }

      #infowindow > span:hover {
        cursor: pointer;
      }

      #info-body {
        color: #000;
        padding: 4px;
      }

      #info-body > h4 {
        padding: 5px 0px;
        border: 1px solid #000028;
        border-radius: 5px;
        text-align: center;
        color: #FFF;
        background-color: rgba(0,0,51,.9);
        margin: 3px 0px;
        font-size: 120%;
      }

      #full-statement, #small-statement {
        margin: 3px auto;
        border-radius: 4px;
        border: 1px solid #999;
        padding: 4px;
        cursor: pointer;
      }

      #sql-header, #area_served-form {
        background: rgba(255,255,255,0.9);
        border-radius: 5px;
        border: 1px solid #999;
      }

      #sql-header {
        margin-top: 1.5vh;
        padding: 0;
      }

      #sql-header > p {
          padding: 7px 15px;
          border-bottom: 1px solid #999;
      }

      #deselect {
        padding: 5px 5px;
      }

      #area-submit, #reset-zip {
        padding: 2px;
        font-family: inherit;
        cursor: pointer;
        margin: 0 auto;
      }

      /*Perhaps a button selector would be best here*/
      button, #area-submit {
        background-color: #EEE;
        border: 1px solid #999;
        border-radius: 3px;
        margin-bottom: 5px;
        color: #444;
      }

      #reset-zip {
        padding: 4px;
      }

      .filter-menu {
        padding: 1px 1px;
      }

      .filter-menu > div {
        background: rgba(255,255,255,0.9);
        padding: 1px 1px;
        border: 1px solid #999;
        border-radius: 3px;
        text-align: left;
      }

      .filter-menu > h3 {
        background: rgba(238,238,238,0.9);
        border: 1px solid #999;
        border-radius: 3px;
        margin: 3px 0px;
        padding: .5vh;
        text-align: center;
        cursor: pointer;
      }

      .filter-menu > h3:hover {
        background: rgba(170,170,170,.9);
      }

      .filter-menu > h3:hover > a {
        color: #222;
      }

      .filter-menu > h3 > a {
        text-decoration: none;
        color: #444;
      }

      /*HACKY SOLUTION FOR GETTING THINGS TO FORMAT IN THE INFOWINDOW*/
      #hide-filters {
        position: absolute;
        bottom: 20px;
        right: 20px;
        z-index: 2;
      }
      .hidden {
        display: none;
      }

      #infowindow.thingshidden {
        right: 50px;
      }

      @media only screen and (min-width: 769px) {
        #map {
          height: 600px;
        }
        #side-filters {
          height: 600px;
          overflow-y: scroll;
        }
      }

      @media only screen and (max-width: 768px) {
        #infowindow {
          position: fixed;
          right: 0;
          top: 0;
          width: 100vw;
          min-height: 62vh;
          background: rgba(255, 255, 255, 1);
          z-index: 2000;
        }
        #side-filters {
          position: fixed;
          top: 0px;
          right: 0px;
          height: 100vh;
          overflow-y: scroll;
        }
      }
      </style>

    <div style="position:relative;">
      <div id="infowindow">
      </div>
    </div>
    <div id="map"></div>


      <!--below are templates that are used to create the html for the infowindows using underscore's templating engine-->
      <script type="text/template" id="info-template">
        <p><!--Number of locations at this point: <%=length%>-->
        <% if (length>1) {
          print("There are " + length + " locations at this point.");
        }%>
        </p>
        <span><% if (length > 1) {
          print("<img src=\"http://ds.haverford.edu/mappingmicrofinance_map/MappingMicrofinancePhilly/cancel-circle.png\" alt=\"exit\" width=\"22px\" height=\"22px\"/>");
        } else {
          print("<img src=\"http://ds.haverford.edu/mappingmicrofinance_map/MappingMicrofinancePhilly/cancel-circle-white.png\" alt=\"exit\" width=\"22px\" height=\"22px\"/>");
        }%></span> <!--icons from https://icomoon.io-->
        <%if (length < infoTabsAllowed && length > 1) {
          print("<div id=\"tabrow\">");
          for (i=0; i<length; i++) {
            print("<span data=\""+ i + "\" id=\"tab" + i + "\" class=\"info-tab\">location " + (i + 1) + " </span>");
          }
          print("</div>");
        } else if(length > 1) {
          print("<div><p>Zoom in to see them individually.</p></div>");
        }%>
        <div id="info-body">
        </div>
      </script>
      <script type="text/template" id="info-body-template">
        <h4><%=name%></h4>
        <%=address%> <%=city%>, <%=state%> <%=zipcode%><br>
        <% if (phone_number != "") {print("<div>Phone: " + phone_number + "</div>");}%>
        <div><a href="mailto:<%=email%>"><%=email%></a></div>
        <a href="<%=link%>"><%=link%></a>
        <div id="mission">
        <div id="small-statement"><%=small%></div>
        <div id="full-statement" class="hidden"> <%=mission%> </div>
        </div>
      </script>

      <!-- include cartodb.js library -->
      <script src="http://libs.cartocdn.com/cartodb.js/v3/3.14/cartodb.js" type="text/javascript"></script>
      <!--code source below-->
      <script src="http://ds.haverford.edu/mappingmicrofinance_map/MappingMicrofinancePhilly/mappingmicromap.js" type="text/javascript"></script>
